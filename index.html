
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Three.js Geometry Browser</title>
  <style>
  
  
  body {
    margin:0;
    font-family: 'monospace';
    font-size: 15px;
    line-height: 18px;
    overflow: hidden;
  }
  
  </style>
</head>
<body>
  
  <script src="https://threejs.org/build/three.min.js"></script>
  <script src='https://threejs.org/examples/js/libs/dat.gui.min.js'></script>
  <script src="https://threejs.org/examples/js/controls/OrbitControls.js"></script>
  
  <script src="js/shaders.js"></script>
  <script>
  
  var gui = null
  var guiParam = {};
  var renderer = null
  var scene = null
  var camera = null
  var container = null
  var shaderMat = null;
  
  function init(){
    
    gui = new dat.GUI();
    renderer = new THREE.WebGLRenderer( { antialias: false } );
    scene = new THREE.Scene();
    camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );
    container = new THREE.Object3D();
    
    
    guiParam.sliceIndex = 50;
    gui.add(guiParam, 'sliceIndex', 0, 256)
    .step(1)
    .name("Slice")
    .onChange(function(val){
      var uniforms = shaderMat.uniforms;
      uniforms.indexSliceToDisplay.value = val;
    })
    
    
    
    
    renderer.setPixelRatio( window.devicePixelRatio );
    renderer.setSize( window.innerWidth, window.innerHeight );
    renderer.setClearColor( 0xEEEEEE, 1 );
    document.body.appendChild( renderer.domElement );
    
    var orbit = new THREE.OrbitControls( camera, renderer.domElement );
    
    var mosaicTexture = THREE.ImageUtils.loadTexture( "data/176_256_256_zspace.png" )
    mosaicTexture.magFilter = THREE.NearestFilter;
    mosaicTexture.minFilter = THREE.NearestFilter;
        
    var xspaceLength = 176;
    var yspaceLength = 256;
    var zspaceLength = 256;
    
    camera.position.z = zspaceLength;
    
    shaderMat = new THREE.ShaderMaterial( {
      uniforms: {
        // the textures
        nbOfTextureUsed: {
          type: "i",
          value: 1
        },
        // the number of slice per row
        nbSlicePerRow: {
          type: "i",
          value: 23
        },
        // the number of slice per column
        nbSlicePerRowCol: {
          type: "i",
          value: 12
        },
        // the number of slice in total
        nbSliceTotal: {
          type: "i",
          value: 256  // because along zspace
        },
        // the index of the slice to display
        indexSliceToDisplay: {
          type: "i",
          value: 50 
        },
        // xspace length
        xspaceLength: {
          type: "i",
          value: xspaceLength 
        },
        // yspace length
        yspaceLength: {
          type: "i",
          value: yspaceLength 
        },
        // zspace length
        zspaceLength: {
          type: "i",
          value: zspaceLength 
        },
        textures: {
          type: "t",
          value:  [mosaicTexture]
        }
      }
      ,
      vertexShader: shaders.vertex,
      fragmentShader: shaders.fragment,
      side: THREE.DoubleSide,
      transparent: true
    });
    
    
    var geometry = new THREE.PlaneBufferGeometry( xspaceLength, yspaceLength, 1 );
    var plane = new THREE.Mesh( geometry, shaderMat );
    container.add( plane );
    
    scene.add( container );
    
    console.log(shaders.vertex);
  }
  
  
  function render() {
    requestAnimationFrame( render );
    renderer.render( scene, camera );
  };
  
  
  window.addEventListener( 'resize', function () {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize( window.innerWidth, window.innerHeight );
  }, false );
  
  
  
  init();
  render();
  
  </script>
</body>
</html>
